var Gourmap;!function(a){var b=function(){function b(b,c,d){var e=this;this.$scope=b,this.search=c,this.helloModel=d,this.markersCracker=new a.MarkersCracker,this.$scope.helloModel=d,this.$scope.callSearch=function(a){return e.freeWordSearch(a)},this.fitHeightForFullMap();var f={zoom:16,center:new google.maps.LatLng(a.HotpepperApi.lat,a.HotpepperApi.lng)};b.map=new google.maps.Map(document.getElementById("map-view"),f),google.maps.event.addListener(b.map,"drag",function(){e.renderMap()})}return b.prototype.renderMap=function(){var b,c=this;_.isEqual(b,!1)&&clearTimeout(b),b=setTimeout(function(){a.HotpepperApi.lat=c.$scope.map.getCenter().lat(),a.HotpepperApi.lng=c.$scope.map.getCenter().lng(),c.freeWordSearch(c.$scope.freeWord)},300)},b.prototype.fitHeightForFullMap=function(){var a=$("#map-view"),b=$("#entry-collection-view");a.css("height",Util.getMapHeight()+"px"),b.css("height",Util.getMapHeight()+"px");var c;$(window).on("resize",function(){_.isEqual(c,!1)&&clearTimeout(c),c=setTimeout(function(){a.css("height",Util.getMapHeight()+"px"),b.css("height",Util.getMapHeight()+"px")},300)})},b.prototype.freeWordSearch=function(b){var c=this,d=a.HotpepperApi.createApiPath(b),e=this.search.$http.jsonp(d);e.success(function(b){c.markersCracker.remove();var d=new a.GoogleMapFactory(b);c.$scope.shops=d.createShopMarkers();var e=new a.MarkersFactory(c.$scope.shops,c.$scope.map);c.$scope.markers=e.createMarkers(),c.markersCracker.create(c.$scope.markers)})},b}();a.GourmapController=b}(Gourmap||(Gourmap={}));var Gourmap;!function(a){var b=function(){function a(a){return this.$http=a,this}return a}();a.Search=b}(Gourmap||(Gourmap={}));var Gourmap;!function(a){var b=function(){function b(){this.gourmap=angular.module("gourmap",[]),this.gourmap.controller("gourmapCtrl",a.GourmapController).factory("search",a.Search).factory("helloModel",function(){return new a.Hello("Gourmap","Hello, Angular")})}return b}();a.Apprication=b,new b}(Gourmap||(Gourmap={}));var Gourmap;!function(a){var b=function(){function b(a){this.json=a}return b.prototype.createShopMarkers=function(){var b=[];return angular.forEach(this.json.results.shop,function(c){b.push(new a.ShopMarker(c.id,c.name,parseFloat(c.lat),parseFloat(c.lng),!1,c.access,c.address,c.catch,c.logo_image))}),b},b}();a.GoogleMapFactory=b}(Gourmap||(Gourmap={}));var Gourmap;!function(a){var b=function(){function a(){this.markerCacheList=new google.maps.MVCArray}return a.prototype.create=function(a){var b=this;angular.forEach(a,function(a){b.markerCacheList.push(a)})},a.prototype.remove=function(){this.markerCacheList.forEach(function(a){a.setMap(null)})},a}();a.MarkersCracker=b}(Gourmap||(Gourmap={}));var Gourmap;!function(a){var b=function(){function a(a,b){this.shopMarkers=a,this.map=b}return a.prototype.createMarkers=function(){var a=this,b=[];return angular.forEach(this.shopMarkers,function(c){var d=a.createMarker(c);b.push(d)}),b},a.prototype.createMarker=function(a){var b=this,c=new google.maps.InfoWindow({content:'<div class="info"><a href="http://www.hotpepper.jp/str'+a.id+'" target="_blank">'+a.name+"</a></div>"}),d=new google.maps.Marker({map:this.map,position:new google.maps.LatLng(a.lat,a.lng)});return google.maps.event.addListener(d,"click",function(){c.open(b.map,d)}),d},a}();a.MarkersFactory=b}(Gourmap||(Gourmap={}));var Gourmap;!function(a){var b=function(){function a(a,b){this.title=a,this.description=b}return a}();a.Hello=b}(Gourmap||(Gourmap={}));var Gourmap;!function(a){var b=function(){function a(a,b){return this.latitude=a,this.longitude=b,this}return a}();a.MapCenter=b}(Gourmap||(Gourmap={}));var Gourmap;!function(a){var b=function(){function a(a,b,c,d,e,f,g,h,i){return this.id=a,this.name=b,this.lat=c,this.lng=d,this.showWindow=e,this.access=f,this.address=g,this.description=h,this.logo_image=i,this}return a}();a.ShopMarker=b}(Gourmap||(Gourmap={}));var Gourmap;!function(a){var b=function(){function a(){if(this.key="47f38c102d2ddf17",this.format="jsonp",this.callback="JSON_CALLBACK",this.lat=35.6742506,this.lng=139.7649463,a._instance)throw console.log("Error: Instantiation failed");a._instance=this}return a.getInstance=function(){return _.isNull(a._instance)&&(a._instance=new a),a._instance},a.prototype.createApiPath=function(a){return"http://webservice.recruit.co.jp/hotpepper/gourmet/v1/?key="+this.key+"&format="+this.format+"&callback="+this.callback+"&lat="+this.lat+"&lng="+this.lng+"&keyword="+a},a._instance=null,a}();a.HotpepperApiSingleton=b,a.HotpepperApi=b.getInstance()}(Gourmap||(Gourmap={}));var Util;!function(a){function b(a){for(var b=0,c=0,d=document.getElementById(a);d.parentNode;)b+=d.offsetLeft,c+=d.offsetTop,d=d.parentNode;return{left:b,top:c}}function c(){return window.innerHeight-b("result-layout").top}a.getElmPosition=b,a.getMapHeight=c}(Util||(Util={}));